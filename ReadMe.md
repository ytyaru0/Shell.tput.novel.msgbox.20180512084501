# このソフトウェアについて

Bashで1文字ずつ表示する画面。

# 使い方

```bash
. novel.sh
msg "一行目" /
    "二行目" /
```

```bash
. novel.sh
MsgBox /tmp/scenario.txt
```

```bash
. novel.sh
Novel /tmp/scenario.txt
```

## オプション

オプション|
----------|
`-w`|1文字あたりの遅延秒数（小数点可）。文字ごとに遅延時間を指定可。
`-p`|表示位置。`[t|l]:[l|r|c]`。文字列の[上|左]を[左|右|中]寄せする。または数値。
`-f`|文字の流れる方向。[r|c]:[t|b|l|r]
`-c`|カーソルの表示/非表示を切替。点滅の切替。

### 設定ファイル

msgbox.ini
```
[Position]
top=top
left=left
[FlowDirection]
row=bottom
col=right
[Wait]
*=0.05
、=0.05
。=0.1
\n=0.1
[Cursor]
char=▼
blink=2.5
key=*
```

### シナリオファイル

```
表示関数はMsgBox, Novelの2種類ある。
これらの違いは1ページに表示する行数である。

MsgBoxは4行など少ない行数を表示する。
Novelはターミナルの最大行数だけ表示する。

なお、どちらも表示しきったら改ページすることで
次の文章を表示することができる。

また、指定した箇所で停止や改ページができる。

---

折り返しや改ページはターミナルのサイズに依存する。
もし1段落の文章が1ページ内に収まらなかった場合は
自動で改ページしたい。
だが、2バイト文字判定しないと表示幅の事前計算ができない。

ターミナル上での表示桁数が算出できない。
2バイト文字の幅算出が必要か。

>./next_senario.txt
```

#### 停止と改ページ

コマンド|意味
--------|----
停止|キー入力待ち受け
改ページ|キー入力待ち受け。その後画面をクリアする

#### コマンド

段落（パラグラフ）ごとに停止や改ページしたいなら以下のような設定をする。
```
autostop=p
autopage=p
```

表現|意味
----|----
p|段落（パラグラフ）。改行2つ分。
.|句点。「。」1文の終わり。
,|読点。「、」
|何も代入しなければ設定クリア

#### wait

`[S]`のある時点で一時停止となる。

```
一時停止[S]
一[S]時[S]停[S]止[S]
```

#### 改ページ

`---`だけの行により改ページとなる。`-`は3つ以上でも可。前後の空行は無くても良い。あればすべて無視する。

```
改ページ前

---

改ページ後
```

#### シナリオ移動

`>`で別のシナリオファイルを読みこませる。

```
>シナリオファイルパス
```
```
> ./next_senario.txt
```
```
> ./next_senario.txt:label
```

`:ラベル名`を指定するとそのファイルのラベル位置へ移動する。（ラベルは後述）

#### ラベル移動

`:`でラベルを貼れる。`>:`で指定したラベルへ移動する。ラベルは同一シナリオファイル内に移動するために使う。なお、前後のスペースは無視される

```
: ラベル

テキスト

>: ラベル
```

上記の場合は無限ループになる。通常、分岐とともに使う。

#### 分岐

##### 選択肢の結果を他のファイルに委ねる

選択肢により別のシナリオファイルを読ませる。

```
何かの質問文。

* はい > ./senario1.txt
* いいえ > ./senario2.txt
```

同じシナリオファイルだが、指定したラベルへ飛ばす。

```
何かの質問文。

* はい > ./res1.txt:YES
* いいえ > ./ans1.txt:NO
```

##### 選択肢と結果だけのファイル

選択肢がラベルになる。なお、ラベル名は`0`から始まる数値に置き換えてもいい。

```
何かの質問文。

* はい
* いいえ

:はい
「はい」を選んだ。
>:END

:いいえ
「いいえ」を選んだ。
>:END

:END
終わり。
```

```
何かの質問文。

* はい
* いいえ

:0
「はい」を選んだ。
>:END

:1
「いいえ」を選んだ。
>:END

:END
終わり。
```

##### 他にもある場合

同名のラベルが複数存在した場合、直近のラベルを優先する。

```
何かの質問文。

* はい
* いいえ

:はい
「はい」を選んだ。
>:END

:いいえ
「いいえ」を選んだ。
>:END

:END
質問１終わり。

質問２。

* はい
* いいえ

:はい
「はい」を選んだ2。
>:END

:いいえ
「いいえ」を選んだ2。
>:END

:END
質問２終わり。
```

たとえば以下のような場合、`>:はい`により`YES1`に飛ぶ。もし`YES2`に飛ばしたいなら、ラベルを別名にせねばならない。

```
>:はい

* はい
* いいえ

:はい
YES1
>:END
:END

* はい
* いいえ

:はい
YES2
>:END
:END
```

##### 任意名ラベル

選択肢に任意のラベルを付与する。

```
>:Y2

* はい :Y1
* いいえ

:Y1
YES1
>:END
:END

* はい :Y2
* いいえ

:Y2
YES2
>:END
:END
```
## 実行画面

```sh
> はい
  いいえ
```

* 矢印キーの上(`↑`)と下(`↓`)でカーソル移動
* `Enter`, `Space`のいずれかで決定

### 結果の取得

選択した項目のインデックス値を返す。(0..255)

```bash
. choice.sh
Choice "はい" "いいえ"
res=$?
[ $? -eq 0 ] && echo YES
[ $? -eq 1 ] && echo NO
```

# 開発環境

* [Raspberry Pi](https://ja.wikipedia.org/wiki/Raspberry_Pi) 3 Model B
    * [Raspbian](https://www.raspberrypi.org/downloads/raspbian/) GNU/Linux 8.0 (jessie)
        * bash 4.3.30

# ライセンス

このソフトウェアはCC0ライセンスである。

[![CC0](http://i.creativecommons.org/p/zero/1.0/88x31.png "CC0")](http://creativecommons.org/publicdomain/zero/1.0/deed.ja)
